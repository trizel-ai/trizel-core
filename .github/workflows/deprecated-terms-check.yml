name: Deprecated Terms Check

on:
  pull_request:
    types: [opened, synchronize, reopened]
  push:
    branches: [main, master, develop]

jobs:
  check-deprecated-terms:
    runs-on: ubuntu-latest
    name: Check for deprecated terminology
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Check for STOE
        run: |
          echo "Checking for deprecated term 'STOE'..."
          if grep -rn "STOE" \
            --exclude-dir=.git \
            --exclude-dir=.github \
            --exclude="DEPRECATED_TERMS.md" \
            --exclude="IMPLEMENTATION_SUMMARY.md" \
            . ; then
            echo "❌ ERROR: Found deprecated term 'STOE'"
            echo "This term is permanently forbidden. Please remove it completely."
            exit 1
          fi
          echo "✓ No instances of 'STOE' found"
      
      - name: Check for V12-V22 version labels
        run: |
          echo "Checking for deprecated version labels (V12-V22)..."
          if grep -rEn "\bV(12|13|14|15|16|17|18|19|20|21|22)\b" \
            --exclude-dir=.git \
            --exclude-dir=.github \
            --exclude="DEPRECATED_TERMS.md" \
            --exclude="IMPLEMENTATION_SUMMARY.md" \
            . ; then
            echo "❌ ERROR: Found deprecated version labels (V12-V22)"
            echo "These version labels are permanently forbidden. Please remove them completely."
            exit 1
          fi
          echo "✓ No deprecated version labels found"
      
      - name: Check for versioned system labels
        run: |
          echo "Checking for versioned system labels..."
          if grep -rEin "\bV[0-9]+ system\b" \
            --exclude-dir=.git \
            --exclude-dir=.github \
            --exclude="DEPRECATED_TERMS.md" \
            --exclude="IMPLEMENTATION_SUMMARY.md" \
            . ; then
            echo "❌ ERROR: Found versioned system labels"
            echo "Versioned system labels are forbidden. Please remove them completely."
            exit 1
          fi
          echo "✓ No versioned system labels found"
      
      - name: Verify algorithm name format
        run: |
          echo "Checking for incorrect algorithm name variants..."
          
          # Check for common incorrect variants (case-sensitive)
          if grep -rn "AUTO-DZ-ACT\|AutoDzAct\|auto dz act\|AUTO DZ ACT system\|AUTO DZ ACT v" \
            --exclude-dir=.git \
            --exclude-dir=.github \
            --exclude="DEPRECATED_TERMS.md" \
            --exclude="IMPLEMENTATION_SUMMARY.md" \
            . ; then
            echo "❌ ERROR: Found incorrect algorithm name variant"
            echo "The ONLY allowed algorithm name is: AUTO DZ ACT"
            echo "No variants, no 'system' suffix, no version numbers allowed."
            exit 1
          fi
          echo "✓ Algorithm name format check passed"
      
      - name: Summary
        if: success()
        run: |
          echo ""
          echo "✓ All deprecated terms checks PASSED"
          echo "✓ No forbidden terminology detected"
          echo "✓ Repository compliant with TRIZEL DIRECTIVE"
