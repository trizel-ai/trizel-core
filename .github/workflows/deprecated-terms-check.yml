name: Deprecated Terms Check

on:
  pull_request:
    types: [opened, synchronize, reopened]
  push:
    branches: [main, master, develop]

permissions:
  contents: read

jobs:
  check-deprecated-terms:
    runs-on: ubuntu-latest
    name: Check for deprecated terminology

    env:
      # Scan only data-bearing files (no Markdown), so docs can safely mention forbidden terms.
      GREP_INCLUDES: "--include=*.yaml --include=*.yml --include=*.json"
      # Still exclude obvious non-target dirs (and any other dirs you want to ignore)
      GREP_EXCLUDES: "--exclude-dir=.git --exclude-dir=.github --exclude-dir=node_modules"

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Check for STOE
        run: |
          echo "Checking for deprecated term 'STOE' in YAML/JSON only..."
          if grep -rEn $GREP_INCLUDES $GREP_EXCLUDES "STOE" . ; then
            echo "❌ ERROR: Found deprecated term 'STOE' in YAML/JSON payload"
            echo "This term is permanently forbidden in data-bearing files. Remove it completely."
            exit 1
          fi
          echo "✓ No instances of 'STOE' found in YAML/JSON"

      - name: Check for V12-V22 version labels
        run: |
          echo "Checking for deprecated version labels (V12-V22) in YAML/JSON only..."
          if grep -rEn $GREP_INCLUDES $GREP_EXCLUDES "\bV(12|13|14|15|16|17|18|19|20|21|22)\b" . ; then
            echo "❌ ERROR: Found deprecated version labels (V12-V22) in YAML/JSON payload"
            echo "These labels are permanently forbidden in data-bearing files. Remove them completely."
            exit 1
          fi
          echo "✓ No deprecated version labels found in YAML/JSON"

      - name: Check for versioned system labels
        run: |
          echo "Checking for versioned system labels in YAML/JSON only..."
          if grep -rEin $GREP_INCLUDES $GREP_EXCLUDES "\bV[0-9]+ system\b" . ; then
            echo "❌ ERROR: Found versioned system labels in YAML/JSON payload"
            echo "Versioned system labels are forbidden in data-bearing files. Remove them completely."
            exit 1
          fi
          echo "✓ No versioned system labels found in YAML/JSON"

      - name: Verify algorithm name format
        run: |
          echo "Checking for incorrect algorithm name variants in YAML/JSON only..."

          # Use extended regex (-E) and a single pattern with alternation.
          if grep -rEn $GREP_INCLUDES $GREP_EXCLUDES "(AUTO-DZ-ACT|AutoDzAct|auto dz act|AUTO DZ ACT system|AUTO DZ ACT v)" . ; then
            echo "❌ ERROR: Found incorrect algorithm name variant in YAML/JSON payload"
            echo "The ONLY allowed algorithm name is: AUTO DZ ACT"
            echo "No variants, no 'system' suffix, no version numbers allowed."
            exit 1
          fi
          echo "✓ Algorithm name format check passed (YAML/JSON)"

      - name: Summary
        if: success()
        run: |
          echo ""
          echo "✓ All deprecated terms checks PASSED"
          echo "✓ No forbidden terminology detected in YAML/JSON payloads"
          echo "✓ Repository compliant with TRIZEL DIRECTIVE"
