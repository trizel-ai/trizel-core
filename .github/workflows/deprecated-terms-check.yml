name: Deprecated Terms Check

on:
  pull_request:
    types: [opened, synchronize, reopened]
  push:
    branches: [main, master, develop]

permissions:
  contents: read

jobs:
  check-deprecated-terms:
    runs-on: ubuntu-latest
    name: Check for deprecated terminology

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # Scope STOE checks strictly to canonical metadata payloads (YAML/JSON only),
      # to avoid false positives from documentation that may mention the term as a forbidden example.
      - name: Check for STOE in metadata files only (YAML/JSON)
        run: |
          echo "Checking for deprecated term 'STOE' in YAML/JSON metadata files only..."

          if grep -rEn "\bSTOE\b" \
            --include="*.yml" \
            --include="*.yaml" \
            --include="*.json" \
            . ; then
            echo "❌ ERROR: Found deprecated term 'STOE' in metadata payload (YAML/JSON)."
            echo "STOE is permanently forbidden inside canonical metadata files."
            exit 1
          fi

          echo "✓ No instances of 'STOE' found in metadata files"

      # Version labels are deprecated as payload tokens as well; keep scope to YAML/JSON.
      - name: Check for V12-V22 version labels in metadata files only (YAML/JSON)
        run: |
          echo "Checking for deprecated version labels (V12-V22) in YAML/JSON metadata files only..."

          if grep -rEn "\bV(12|13|14|15|16|17|18|19|20|21|22)\b" \
            --include="*.yml" \
            --include="*.yaml" \
            --include="*.json" \
            . ; then
            echo "❌ ERROR: Found deprecated version labels (V12-V22) in metadata payload (YAML/JSON)."
            echo "These version labels are permanently forbidden inside canonical metadata files."
            exit 1
          fi

          echo "✓ No deprecated version labels found in metadata files"

      # Same: keep “versioned system labels” restricted to YAML/JSON payloads.
      - name: Check for versioned system labels in metadata files only (YAML/JSON)
        run: |
          echo "Checking for versioned system labels in YAML/JSON metadata files only..."

          if grep -rEin "\bV[0-9]+\s+system\b" \
            --include="*.yml" \
            --include="*.yaml" \
            --include="*.json" \
            . ; then
            echo "❌ ERROR: Found versioned system labels in metadata payload (YAML/JSON)."
            echo "Versioned system labels are forbidden inside canonical metadata files."
            exit 1
          fi

          echo "✓ No versioned system labels found in metadata files"

      # Algorithm name variants: keep repo-wide, but exclude .git and workflow directory to avoid self-matches.
      - name: Verify algorithm name format
        run: |
          echo "Checking for incorrect algorithm name variants (repo-wide)..."

          if grep -rn \
            --exclude-dir=.git \
            --exclude-dir=.github \
            "AUTO-DZ-ACT\|AutoDzAct\|auto dz act\|AUTO DZ ACT system\|AUTO DZ ACT v" \
            . ; then
            echo "❌ ERROR: Found incorrect algorithm name variant"
            echo "The ONLY allowed algorithm name is: AUTO DZ ACT"
            echo "No variants, no 'system' suffix, no version numbers allowed."
            exit 1
          fi

          echo "✓ Algorithm name format check passed"

      - name: Summary
        if: success()
        run: |
          echo ""
          echo "✓ All deprecated terms checks PASSED"
          echo "✓ No forbidden terminology detected in scoped payloads"
          echo "✓ Repository compliant with TRIZEL DIRECTIVE"
